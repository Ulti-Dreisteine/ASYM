## 系统辨识算例

本算例借鉴渐近辨识算法ASYM的思想，但不完全照搬该算法细节：首先，采用最小二乘回归（Partial Least Squares, PLS）的方式使用足够高阶的ARX模型对线性系统进行一致无偏的逼近（渐近）；进一步地，利用MSE、AIC、BIC、MDL等误差和信息准则，在高阶模型基础上对其进行降阶，从而得到一个低阶且性能良好的系统辨识模型；最后，基于渐近辨识理论，计算所得低阶模型在各频率处的误差界。

### 一、案例过程

考虑如下离散时间系统：

$$
A(q)y(t) = B(q)u(t) + C(q)e(t)
$$

其中：
1. $y(t)$、$u(t)$、$e(t)$ 分别表示系统在 $t$ 时刻的输出、输入和噪声；
2. $q^{-1}$ 表示单位延迟算子：$q^{-1} x(t) = x(t-1)$；
3. $A(q)$、$B(q)$、$C(q)$ 分别表示关于 $q^{-1}$ 的多项式：
    - $A(q) = 1 + a_1 q^{-1} + \cdots + a_{n_a} q^{-n_a}$ 为系统分母多项式，归一化为首项为1，阶数为 $n_a$；
    - $B(q) = b_0 + b_1 q^{-1} + \cdots + b_{n_b} q^{-n_b}$ 为输入-输出多项式，阶数为 $n_b$；
    - $C(q) = 1 + c_1 q^{-1} + \cdots + c_{n_c} q^{-n_c}$ 为噪声滤波多项式，归一化为首项为1，阶数为 $n_c$。对于ARX过程，$C(q)=1$；对于ARMAX过程，$C(q)$ 为非平凡多项式。

在本算例中，考虑如下2输入2输出的MIMO过程：

$$
A(q)=\begin{bmatrix}
1-1.5\,q^{-1}+0.7\,q^{-2} & 0\\[6pt]
0 & 1-1.4\,q^{-1}+0.65\,q^{-2}
\end{bmatrix},
$$

$$
B(q)=\begin{bmatrix}
q^{-1}+0.5\,q^{-2} & q^{-2}\\[6pt]
0.75\,q^{-1}+0.25\,q^{-2} & q^{-1}-0.3\,q^{-2}
\end{bmatrix},
$$

$$
C(q)=\begin{bmatrix}
1-q^{-1}+0.2\,q^{-2} & 0\\[6pt]
0 & 1-0.9\,q^{-1}
\end{bmatrix}
$$

该MIMO过程的阶跃响应曲线如下：

<img src="../img/s0_arx_step_response.png" alt="过程阶跃响应曲线" width="600">

接下来进行仿真采样，设输入 $u(t)$ 为广义二值噪声GBN，最短保持时间等于采样时间为1秒，平均转换时间为5秒；噪声 $e(t)$ 为均值为0、方差为0.1的高斯噪声，即：

$$
u_1(t) \sim \text{GBN}(1, 5),\quad
u_2(t) \sim \text{GBN}(1, 5),
$$

$$
e_1(t) \sim \mathcal{N}(0, 0.1),\quad
e_2(t) \sim \mathcal{N}(0, 0.1)
$$

仿真2000步，得到的输入输出数据曲线如下：

<img src="../img/s0_arx_simulation_results.png" alt="输入输出数据曲线" width="600">

### 二、系统辨识

本节旨在通过输入输出数据，获得与实际系统尽可能接近的ARX模型，即：

$$
\hat{A}(q)y(t) = \hat{B}(q)u(t) + e(t)
$$

注意，我们故意采用ARX模型将噪声设为白噪声，即 $C(q)=1$，这与上一节实际系统噪声存在差异。

首先，采用一个高阶模型对过程进行辨识，作为后续降阶辨识的对比基准（benchmark）。设模型阶数为 $n_a = n_b = 20$（这个阶数很高，模型十分复杂），所得模型与实际过程阶跃响应对比如下：

<img src="../img/s1_sysident_comparison_benchmark.png" alt="高阶模型阶跃响应对比" width="600">

可见，高阶模型的阶跃响应与实际过程非常接近。然而，高阶模型参数较多，且部分参数数值较小，不利于实际应用。接下来，借鉴渐近辨识的思想对系统进行降阶辨识。

具体步骤如下：

1. 预设从1到benchmark模型阶数的一系列阶数 $n$ 的列表；
2. 对于MIMO系统中每个SISO子通道，分别计算辨识模型的AIC随阶数变化的曲线；
3. 选择AIC值最小的阶数（曲线肘部点）作为该子系统的最终阶数。

AIC准则公式如下：

$$
\text{AIC} = 2n + N \ln(\text{MSE})
$$

其中，$\text{MSE}$ 为该SISO通道与基准模型对比所得均方误差（Mean Squared Error），计算公式为：

$$
\text{MSE} = \frac{1}{N} \sum_{t=1}^{N} \left(\hat{y}_{\text{bm}}(t) - \hat{y}(t) \right)^2
$$

其中：

$$
\hat{y}_{\text{bm}}(t) = \sum_{i=1}^{n_a} \hat{a}_{\text{bm}, i} y(t-i) + \sum_{j=0}^{n_b} \hat{b}_{\text{bm}, j} u(t-j),
$$

$$
\hat{y}(t) = \sum_{i=1}^{n_a} \hat{a}_i y(t-i) + \sum_{j=0}^{n_b} \hat{b}_j u(t-j)
$$

通过上述步骤，得到各子系统的降阶计算结果如下：

<img src="../img/s1_sysident_model_order_selection.png" alt="AIC阶数选择" width="600">

可见，各SISO通道的最优阶数分别为 $n_{11}=4$、$n_{12}=3$、$n_{21}=4$、$n_{22}=4$。基于此，重新进行ARX模型辨识，得到的阶跃响应对比如下：

<img src="../img/s1_sysident_comparison_optimal.png" alt="降阶模型阶跃响应对比" width="600">

频率响应对比如下：

<img src="../img/s1_sysident_freq_comparison_optimal.png" alt="降阶模型频率响应对比" width="600">

### 三、误差界计算

根据渐近辨识理论，模型在频率 $\omega$ 处的误差趋于正态分布 $\mathcal{N}\left( 0,P_{n}(\omega)\right)$，其中：

$$
\lim\limits_{n\to\infty}\frac{1}{n}P_{n}(\omega)=\Phi_{v}(\omega)\cdot\Phi^{-1}(\omega)
$$

$$
\Phi_{v}(\omega)=\left|H^{0}(e^{i\omega})\right|^{2}R
$$

$$
\Phi(\omega)=\begin{pmatrix}\Phi_{u}(\omega)&\Phi_{e,u}(\omega)\\\Phi_{u,e}(\omega)&R\end{pmatrix}
$$

根据Zhu的推论，模型预测的渐近方差表达式为：

$$
\text{var}\left[\widehat{G}_{N}^{n}(e^{i\omega})\right]\approx\frac{n}{N}\frac{\Phi_{v}(\omega)R}{\Phi_{u}(\omega)R-\left|\Phi_{u,e}(\omega)\right|^{2}}
$$

如果控制输入与噪声无关，则：

$$ 
\text{var}\left[\widehat{G}_{N}^{n}(e^{i\omega})\right]\approx\frac{n}{N}\frac{\Phi_{v}(\omega)}{\Phi_{u}(\omega)}
$$

最后，计算得到各子系统的误差界如下：

<img src="../img/s2_error_bound_estimation.png" alt="模型误差界" width="600">

可见，辨识得到的四个SISO通道在 $\omega > 5 \text{ rad/sample}$ 的高频域误差较小，而在 $\omega \leq 5 \text{ rad/sample}$ 的低频段误差增大，这与实际系统的频率特性是一致的。在低频段，噪声增益较大，导致辨识误差增大。